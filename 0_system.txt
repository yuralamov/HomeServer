# Разметка диска при установке (Моя)
# /dev/sda1				512M	ext2	/boot 
# /dev/sda2				128M	esp		/boot/efi	boot
# /dev/sda3				250G	lvm
# /dev/mapper/vg0-root	50G		ext4	/
# /dev/mapper/vg0-tmp	35G		ext4	/tmp
# /dev/mapper/vg0-var	100G	ext4	/var
# /dev/mapper/vg0-home	45G		ext4	/home
# /dev/mapper/vg0-swap	10G		swap	swap
# /dev/sdb1				500G	ext4	/srv
###
# Пользователь с правами sudo	= user:User_123
# Нагрузки при установке	= Samba + сервер SSH
############
# После перезагрузки узнать IP и сетевые интерфейсы
# ip a
############
# Подключение к новоиспеченному серверу по ssh
# На удаленной - 
#	Windows 10:
#		Установка WSL+Ubuntu
#	Windows <10:
#		putty | MinGW+MSys
#	Остальные:
#	Сами знеете
# Вход 
# ssh user@192.168.0.6
# Далее все делаем по ssh
# Если уже были соединения по ssh с этим хостом, то
# ssh-keygen -f "/home/user/.ssh/known_hosts" -R "192.168.0.6"
############
# Замена локации источников на основной сервер
# sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
# sudo sed -i 's/http:\/\/ru.archive.ubuntu.com/http:\/\/archive.ubuntu.com/' /etc/apt/sources.list
# Настройка сети
# Смотреть конфигурационный файл
ls /etc/netplan/
sudo cp /etc/netplan/01-netcfg.yaml /etc/netplan/01-netcfg.yaml.bak
# sudo nano /etc/netplan/01-netcfg.yaml
# Пример настройки сетевых интерфейсов
# Сетевые интерфейсы смотрим по
# ip a
# Провод - статика
###
## This file describes the network interfaces available on your system
## For more information, see netplan(5).
# network:
#  version: 2
#  renderer: networkd
#  ethernets:
#    enp2s0:
#      dhcp4: no
#      addresses: [192.168.0.6/24,]
#      gateway4: 192.168.0.1
#      nameservers:
#        addresses: [192.168.0.1,8.8.8.8,]
###
sudo netplan apply
sudo apt update && sudo apt upgrade -y && sudo reboot -h now
######
# Настройка железа
# Игнорировать закрытие крышки (все-таки ноут)
sudo cp /etc/systemd/logind.conf /etc/systemd/logind.conf.bak
sudo sed -i 's/#HandleLidSwitch=suspend/HandleLidSwitch=ignore/' /etc/systemd/logind.conf
# Погасить экран (через минутку, чтоб не маячил)
echo -e '#!/bin/bash\n#/etc/rc.local\nsetterm --blank 1\nexit 0\n' | sudo tee /etc/rc.local
sudo chown root:root /etc/rc.local && sudo chmod 755 /etc/rc.local
sudo systemctl restart rc-local
# Использования раздела\файла swap после занятости 90% RAM (кроме статичных блоков, к которым давно не обращались)
sudo cp /etc/sysctl.conf /etc/sysctl.conf.bak
echo vm.swappiness=10 | sudo tee -a /etc/sysctl.conf
sudo update-initramfs -u
######
# Установка утилит 
sudo apt install aptitude ntp mc lynx htop fancontrol iftop nmon speedtest-cli smartmontools lm-sensors ssh -y
sudo sensors-detect
sensors
# Каталог для копий и нагрузок
sudo mkdir -p /srv/backup/ /srv/samba/shared
sudo chown -R root:root /srv/backup/ && sudo chmod -R 700 /srv/backup/
sudo chown -R yura:sambashare /srv/samba/ && sudo chmod -R 777 /srv/samba/shared/
# И копирование измененных файлов
sudo cp -p {/etc/apt/sources.list,/etc/sysctl.conf,/etc/rc.local,/etc/systemd/logind.conf,/etc/netplan/01-netcfg.yaml} /srv/backup/
############
# Если навешивать внешний диск, то на постоянку монтирование внешнего диска
#sudo su
#fdisk -l
#lsblk
fdisk /dev/sdc
o
n
t
7
mkfs.ntfs /dev/sdc1
#mkdir -p /mnt/usbhdd
#mount /dev/sdc1 /mnt/usbhdd
#blkid
#echo 'UUID=7808598D70B959E4 /mnt/usbhdd ntfs defaults 0 0' | tee -a /etc/fstab
#exit
sudo cp -p /etc/fstab /srv/backup
############
echo 'The End System Tuning'
